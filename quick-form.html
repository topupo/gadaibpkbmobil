<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajukan Sekarang | GadaiBPKBmobil.com</title>
    <meta name="description" content="Ajukan pinjaman BPKB mobil cepat. Isi form singkat 30 detik, langsung diproses!">
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '745788421683082');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=745788421683082&ev=PageView&noscript=1"
    /></noscript>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(160deg, #075e54 0%, #128c7e 60%, #25d366 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .card {
            background: #fff;
            border-radius: 20px;
            width: 100%;
            max-width: 420px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.35);
        }

        /* ---- HEADER ---- */
        @keyframes gradientShift {
            0%   { background-position: 0% 50%; }
            50%  { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .card-header {
            background: linear-gradient(135deg, #075e54, #128c7e, #25d366, #128c7e, #075e54);
            background-size: 300% 300%;
            animation: gradientShift 6s ease infinite;
            padding: 28px 24px 22px;
            text-align: center;
            position: relative;
        }

        .card-header .logo {
            height: 36px;
            margin-bottom: 12px;
        }

        .card-header h1 {
            color: #fff;
            font-size: 18px;
            font-weight: 700;
            line-height: 1.35;
        }

        .card-header p {
            color: rgba(255,255,255,0.8);
            font-size: 12.5px;
            margin-top: 6px;
        }

        .badge-row {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 14px;
            flex-wrap: wrap;
        }

        .badge {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: #fff;
            font-size: 10.5px;
            padding: 4px 10px;
            border-radius: 50px;
            font-weight: 600;
        }

        /* ---- BODY ---- */
        .card-body {
            padding: 28px 24px 24px;
        }

        .section-label {
            font-size: 11px;
            font-weight: 700;
            color: #888;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 18px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label.field-label {
            display: block;
            font-size: 12.5px;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
        }

        label.field-label .req {
            color: #e53935;
            margin-left: 2px;
        }

        input.field-input,
        select.field-input {
            width: 100%;
            padding: 12px 14px;
            border: 1.5px solid #dde2ec;
            border-radius: 10px;
            font-size: 14px;
            color: #222;
            background: #f7f9fc;
            transition: border-color 0.2s, box-shadow 0.2s;
            -webkit-appearance: none;
            appearance: none;
            outline: none;
        }

        input.field-input:focus,
        select.field-input:focus {
            border-color: #25d366;
            box-shadow: 0 0 0 3px rgba(37,211,102,0.15);
            background: #fff;
        }

        input.field-input.error,
        select.field-input.error {
            border-color: #e53935;
            box-shadow: 0 0 0 3px rgba(229,57,53,0.1);
        }

        .field-error {
            font-size: 11px;
            color: #e53935;
            margin-top: 4px;
            display: none;
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper::after {
            content: '‚ñæ';
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
            pointer-events: none;
            font-size: 14px;
        }

        /* ---- SUBMIT ---- */
        .btn-submit {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #25d366, #128c7e);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: opacity 0.2s, transform 0.1s;
            letter-spacing: 0.3px;
        }

        .btn-submit:hover { opacity: 0.93; }
        .btn-submit:active { transform: scale(0.98); }
        .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; }

        .micro-note {
            text-align: center;
            font-size: 11px;
            color: #999;
            margin-top: 10px;
        }

        /* ---- FOOTER ---- */
        .card-footer {
            background: #f4f6fb;
            padding: 14px 20px;
            text-align: center;
            border-top: 1px solid #eee;
        }

        .card-footer a {
            font-size: 11.5px;
            color: #128c7e;
            text-decoration: none;
            font-weight: 600;
        }

        /* ---- SUCCESS STATE ---- */
        .success-screen {
            display: none;
            padding: 40px 24px;
            text-align: center;
        }

        .success-screen .icon {
            font-size: 56px;
            margin-bottom: 16px;
        }

        .success-screen h2 {
            font-size: 20px;
            color: #003d7a;
            margin-bottom: 8px;
        }

        .success-screen p {
            font-size: 13px;
            color: #666;
            line-height: 1.6;
        }
    </style>
</head>
<body>

<div class="card">

    <!-- HEADER -->
    <div class="card-header">
        <img src="/assets/logo.webp" alt="GadaiBPKBmobil.com" class="logo" onerror="this.style.display='none'">
        <h1>Hitung Simulasi GRATIS<br>BPKB Mobil Anda üöóüõªüöõ</h1>
        <p>Isi form di bawah, fast response 24/7</p>
        <div class="badge-row">
            <span class="badge">‚ö° Cair 1x24 Jam</span>
            <span class="badge">ü§è Bunga 0.79%</span>
            <span class="badge">üóìÔ∏è Tenor Maks 60 Bln</span>
            <span class="badge">üîÑ Bisa Take Over</span>
            <span class="badge">üáÆüá© Seluruh Indonesia</span>
            <span class="badge">‚úÖ Terdaftar OJK</span>
        </div>
    </div>

    <!-- FORM -->
    <div class="card-body" id="formBody">
        <div class="section-label">Data Singkat Anda</div>

        <form id="quickForm" novalidate>

            <!-- NAMA -->
            <div class="form-group">
                <label class="field-label" for="nama">Nama Lengkap <span class="req">*</span></label>
                <input
                    type="text"
                    id="nama"
                    name="nama"
                    class="field-input"
                    placeholder="Contoh: Andy Saputra"
                    autocomplete="name"
                    required
                >
                <div class="field-error" id="err-nama">Nama wajib diisi.</div>
            </div>

            <!-- NOMOR WA -->
            <div class="form-group">
                <label class="field-label" for="whatsapp">Nomor WhatsApp <span class="req">*</span></label>
                <input
                    type="tel"
                    id="whatsapp"
                    name="whatsapp"
                    class="field-input"
                    placeholder="Contoh: 082233445566"
                    autocomplete="tel"
                    inputmode="numeric"
                    required
                >
                <div class="field-error" id="err-wa">Format WA tidak valid. Contoh: 08xxxxxxxxxx</div>
            </div>

            <!-- MERK & TAHUN MOBIL -->
            <div class="form-group">
                <label class="field-label" for="kendaraan">Merk & Tahun Mobil <span class="req">*</span></label>
                <input
                    type="text"
                    id="kendaraan"
                    name="kendaraan"
                    class="field-input"
                    placeholder="Contoh: Toyota New Avanza 1.3 MT 2018"
                    required
                >
                <div class="field-error" id="err-kendaraan">Merk & tahun mobil wajib diisi.</div>
            </div>

            <!-- NOMINAL PENGAJUAN -->
            <div class="form-group">
                <label class="field-label" for="nominal">Nominal Pengajuan <span class="req">*</span></label>
                <div class="select-wrapper">
                    <select id="nominal" name="nominal" class="field-input" required>
                        <option value="">-- Pilih Nominal --</option>
                        <option value="< 20 juta">&lt; Rp 20 Juta</option>
                        <option value="20 - 50 juta">Rp 20 ‚Äì 50 Juta</option>
                        <option value="50 - 100 juta">Rp 50 ‚Äì 100 Juta</option>
                        <option value="100 - 200 juta">Rp 100 ‚Äì 200 Juta</option>
                        <option value="200 - 500 juta">Rp 200 ‚Äì 500 Juta</option>
                        <option value="500 juta - 1 miliar">Rp 500 Juta ‚Äì 1 Miliar</option>
                        <option value="> 1 miliar">&gt; Rp 1 Miliar</option>
                    </select>
                </div>
                <div class="field-error" id="err-nominal">Nominal pengajuan wajib dipilih.</div>
            </div>

            <button type="submit" class="btn-submit" id="submitBtn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="#fff" style="flex-shrink:0">
                    <path d="M12.001 2C6.477 2 2 6.477 2 12c0 1.89.525 3.66 1.438 5.168L2 22l4.978-1.421A9.956 9.956 0 0012.001 22C17.523 22 22 17.523 22 12S17.523 2 12.001 2zm0 1.8A8.2 8.2 0 0120.2 12a8.2 8.2 0 01-8.199 8.2 8.168 8.168 0 01-4.2-1.158l-.301-.179-3.122.891.878-3.036-.196-.313A8.164 8.164 0 013.8 12 8.2 8.2 0 0112.001 3.8zm-2.193 4.3c-.198 0-.52.074-.793.37-.272.296-1.04 1.016-1.04 2.479s1.065 2.876 1.213 3.074c.149.198 2.051 3.274 5.063 4.458.708.272 1.26.434 1.69.556.71.202 1.356.174 1.867.105.57-.077 1.754-.717 2.002-1.41.247-.692.247-1.285.173-1.41-.074-.123-.272-.197-.57-.346-.297-.148-1.754-.866-2.026-.964-.273-.099-.47-.148-.669.149-.198.297-.768.964-.941 1.162-.173.198-.347.223-.644.074-.297-.148-1.255-.463-2.39-1.475-.883-.788-1.479-1.761-1.652-2.058-.173-.297-.018-.457.13-.605.133-.133.297-.347.446-.52.149-.174.198-.298.298-.496.099-.198.05-.372-.025-.52-.074-.149-.668-1.612-.916-2.207-.24-.578-.486-.5-.668-.51l-.57-.01z"/>
                </svg>
                Kirim via WhatsApp
            </button>
            <p class="micro-note">üîí Data Anda 100% aman & tidak disalahgunakan</p>

        </form>
    </div>

    <!-- SUCCESS STATE (hidden initially) -->
    <div class="success-screen" id="successScreen">
        <div class="icon">üéâ</div>
        <h2>Pengajuan Terkirim!</h2>
        <p>Tim GadaiBPKBmobil.com akan segera menghubungi Anda.<br><br>Jika belum ada respons dalam 5 menit, silakan chat langsung melalui tombol di bawah.</p>
        <br>
        <a href="https://wa.me/6282299999036" target="_blank" style="display:inline-block; background: #25d366; color:#fff; padding:12px 28px; border-radius:10px; font-weight:700; text-decoration:none; font-size:15px;">
            üí¨ Chat WhatsApp
        </a>
    </div>

    <!-- FOOTER -->
    <div class="card-footer">
        <a href="/">‚Üê Kembali ke halaman utama</a>
    </div>

</div>

<script>
(function () {
    // =====================
    // CONFIG ‚Äî token & URL sudah TIDAK ada di sini
    // semua sensitif disimpan di Netlify Environment Variables
    // =====================
    const WA_NUMBER = "6282299999036";

    // Capture click IDs
    const params = new URLSearchParams(window.location.search);
    const fbclid = params.get('fbclid');
    const gclid  = params.get('gclid');
    if (fbclid) localStorage.setItem('fbclid', fbclid);
    if (gclid)  localStorage.setItem('gclid', gclid);

    // =====================
    // HELPERS
    // =====================
    function showError(id, show) {
        const el = document.getElementById(id);
        if (el) el.style.display = show ? 'block' : 'none';
    }

    function markField(el, hasError) {
        el.classList.toggle('error', hasError);
    }

    function cleanWA(raw) {
        let n = raw.replace(/\D/g, '');
        if (n.startsWith('0')) n = '62' + n.substring(1);
        return n;
    }

    // =====================
    // FORM SUBMIT
    // =====================
    document.getElementById('quickForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const namaEl      = document.getElementById('nama');
        const waEl        = document.getElementById('whatsapp');
        const kendaraanEl = document.getElementById('kendaraan');
        const nominalEl   = document.getElementById('nominal');
        const waRegex     = /^(\+62|62|0)8[1-9][0-9]{6,9}$/;

        let valid = true;

        const namaOk = namaEl.value.trim().length > 1;
        markField(namaEl, !namaOk);
        showError('err-nama', !namaOk);
        if (!namaOk) valid = false;

        const waOk = waRegex.test(waEl.value.trim().replace(/\s+/g, ''));
        markField(waEl, !waOk);
        showError('err-wa', !waOk);
        if (!waOk) valid = false;

        const kendaraanOk = kendaraanEl.value.trim().length > 2;
        markField(kendaraanEl, !kendaraanOk);
        showError('err-kendaraan', !kendaraanOk);
        if (!kendaraanOk) valid = false;

        const nominalOk = nominalEl.value !== '';
        markField(nominalEl, !nominalOk);
        showError('err-nominal', !nominalOk);
        if (!nominalOk) valid = false;

        if (!valid) return;

        // Loading state
        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerHTML = '‚è≥ Mengirim data...';

        const utmParams = new URLSearchParams(window.location.search);
        const waClean   = cleanWA(waEl.value.trim());

        const leadData = {
            nama:         namaEl.value.trim(),
            whatsapp:     waClean,
            nominal:      nominalEl.value,
            tipe:         kendaraanEl.value.trim(),
            nopol:        '',
            pengajuan:    'gadai bpkb',
            bpkb:         'mobil',
            atasnama:     '',
            statustinggal:'',
            merk:         '',
            tahun:        '',
            kecamatan:    '',
            form_source:  'quick-form',
            utm_source:   utmParams.get('utm_source')    || '',
            utm_campaign: utmParams.get('utm_campaign')  || '',
            utm_content:  utmParams.get('utm_content')   || '',
            utm_term:     utmParams.get('utm_term')      || '',
            fbclid:       localStorage.getItem('fbclid') || '',
            gclid:        localStorage.getItem('gclid')  || ''
            // ‚ö†Ô∏è token TIDAK dikirim dari browser ‚Äî ditambahkan di server (Netlify Function)
        };

        // Kirim ke Netlify Function (proxy) ‚Äî bukan langsung ke Google Sheet
        try {
            await fetch('/.netlify/functions/submit', {
                method:  'POST',
                headers: { 'Content-Type': 'application/json' },
                body:    JSON.stringify(leadData)
            });
        } catch (err) {
            console.error('Submit error:', err);
            // Tetap lanjut ke WA meski gagal kirim ke sheet
        }

        // Track conversions
        if (window.fbq) fbq('track', 'Lead');
        if (window.gtag) gtag('event', 'generate_lead');

        // WA message
        const nama    = encodeURIComponent(namaEl.value.trim());
        const kend    = encodeURIComponent(kendaraanEl.value.trim());
        const nominal = encodeURIComponent(nominalEl.value);

        const msg =
`*PENGAJUAN FASILITAS DANA BPKB*%0A%0A` +
`üë§ *Nama:* ${nama}%0A` +
`üì± *WhatsApp:* ${waClean}%0A` +
`üöó *Merk %26 Tahun Mobil:* ${kend}%0A` +
`üí∞ *Nominal Pengajuan:* ${nominal}%0A%0A` +
`_Mohon diproses. Terima kasih!_`;

        window.open(`https://wa.me/${WA_NUMBER}?text=${msg}`, '_blank');

        // Show success
        document.getElementById('formBody').style.display  = 'none';
        document.getElementById('successScreen').style.display = 'block';

        btn.disabled = false;
        btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="#fff" style="flex-shrink:0"><path d="M12.001 2C6.477 2 2 6.477 2 12c0 1.89.525 3.66 1.438 5.168L2 22l4.978-1.421A9.956 9.956 0 0012.001 22C17.523 22 22 17.523 22 12S17.523 2 12.001 2zm0 1.8A8.2 8.2 0 0120.2 12a8.2 8.2 0 01-8.199 8.2 8.168 8.168 0 01-4.2-1.158l-.301-.179-3.122.891.878-3.036-.196-.313A8.164 8.164 0 013.8 12 8.2 8.2 0 0112.001 3.8zm-2.193 4.3c-.198 0-.52.074-.793.37-.272.296-1.04 1.016-1.04 2.479s1.065 2.876 1.213 3.074c.149.198 2.051 3.274 5.063 4.458.708.272 1.26.434 1.69.556.71.202 1.356.174 1.867.105.57-.077 1.754-.717 2.002-1.41.247-.692.247-1.285.173-1.41-.074-.123-.272-.197-.57-.346-.297-.148-1.754-.866-2.026-.964-.273-.099-.47-.148-.669.149-.198.297-.768.964-.941 1.162-.173.198-.347.223-.644.074-.297-.148-1.255-.463-2.39-1.475-.883-.788-1.479-1.761-1.652-2.058-.173-.297-.018-.457.13-.605.133-.133.297-.347.446-.52.149-.174.198-.298.298-.496.099-.198.05-.372-.025-.52-.074-.149-.668-1.612-.916-2.207-.24-.578-.486-.5-.668-.51l-.57-.01z"/></svg> Kirim via WhatsApp';
    });
})();
</script>

</body>
</html>
